<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">


<!-- Mirrored from www.opentk.com/doc/graphics/texture-compression by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 10 May 2016 13:48:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="prev" href="http://www.opentk.com/node/15449" />

<link rel="up" href="textures.html" />

<link rel="next" href="frame-buffer-objects.html" />

<link rel="shortcut icon" href="http://www.opentk.com/sites/all/favicon.ico" type="image/x-icon" />
    <title>BCn Texture Compression | OpenTK</title>
    <!--[if !lt IE 7]> <style type="text/css" media="all">@import "/files/css/0d190fbd13bda50135e2c474ba9cb190.css";</style>
 <![endif]-->
    <!--[if !IE]>--> <style type="text/css" media="all">@import "http://www.opentk.com/files/css/0d190fbd13bda50135e2c474ba9cb190.css";</style>
 <!--<![endif]-->
    <!--[if IE 7]><style type="text/css" media="all">@import "/sites/all/themes/community4/IE67.css";</style><![endif]-->
    </head>

<body class="not-front not-logged-in ntype-book main-sidebar">

    <div id="layer1">
    
        <div id="header-bg">

            <div id="header">
           
                                    <a href="../../index.html"><img src="http://www.opentk.com/sites/all/themes/community3/images/community2_logo.jpg" alt="Home" id="logo" /></a>
                                
                <div id="bg-image"><img src="http://www.opentk.com/sites/all/themes/community2/images/bg-header2.png" width="100%" height="100%" /></div>

                
                                    <h2 class='siteSlogan'>Home of the Open Toolkit library</h2>
                
                
                                  <div class="primary-links-wrapper">
                    <ul class="primary-links" id="navtabs"><li  class="first menu-1-1-2"><a href="../../index.html" title="Return to the OpenTK homepage." class="menu-1-1-2">Home</a></li>
<li  class="menu-1-2-2"><a href="http://www.opentk.com/project/opentk" title="Learn more or download OpenTK." class="menu-1-2-2">Project</a></li>
<li  class="menu-1-3-2"><a href="../../doc.html" title="Read the OpenTK programming guide." class="menu-1-3-2">Documentation</a></li>
<li  class="menu-1-4-2"><a href="http://www.opentk.com/forum/2" title="Discuss OpenTK or ask for help." class="menu-1-4-2">Forum</a></li>
<li  class="menu-1-5-2"><a href="http://www.opentk.com/files/opentk-issues.html" title="View issue reports for OpenTK." class="menu-1-5-2">Issues</a></li>
<li  class="menu-1-6-2"><a href="http://www.opentk.com/blog" title="Read the blogs of OpenTK users." class="menu-1-6-2">Blogs</a></li>
<li  class="menu-1-7-2"><a href="http://www.opentk.com/project/all" title="Search the database of OpenTK projects." class="menu-1-7-2">Gallery</a></li>
<li  class="last menu-1-8-2"><a href="http://www.opentk.com/search" title="Quickly locate content on the site." class="menu-1-8-2">Search</a></li>
</ul>                  </div>
                
            </div>
            
        </div>

        <div id="page" class="clear-block">
            <div id="wrapper" class="clear-block">
                <div id="subwrapper">
                    <div id="container">
                        <div id="content">

                            
                            <div class="content-area">

                                                                    
                                <div class="tabs clear-block">
                                    <div class="breadcrumb"><a href="../../index.html">Home</a> » <a href="../../doc.html" title="What is this all about?">Introduction</a> » <a href="../graphics.html" title="Description of the OpenTK.Graphics namespace, plus a quick OpenGL and OpenGL|ES primer.">Graphics</a> » <a href="textures.html">Textures</a></div>                                </div>
                                
                                
                                
                                <div class="node-content-wrapper">

                                    				<div id="node-195" class="node ntype-book clear-block">

	
			<h1 class="title"><a href="texture-compression.html">BCn Texture Compression</a></h1>    
	
	

    <div class="content">
	    
        <p><strong>Introduction</strong><br />
A widely available texture compression comes from S3, mostly due to Microsoft licensing it and including it into DirectX 7. It uses the file format .dds (DirectDraw Surface), which is basically a copy of the texture in video memory. Every graphics accelerator compatible with DirectX 7 or higher supports this texture compression.</p>
<p><strong>The BCn Formats are:</strong><br />
BC1 = DXT1 = 8 Bytes per Block, Accuracy: R5G6B5 or R5G5B5A1  <b>(0.5 Byte/Texel)</b><br />
BC2 = DXT3 = 16 Bytes per Block, Accuracy: R5G6B5A8  <b>(1 Byte/Texel)</b><br />
BC3 = DXT5 =  16 Bytes per Block, Accuracy: R5G6B5A8  <b>(1 Byte/Texel)</b><br />
BC4 = Basically this is only the alpha channel from DXT5 without the color channel. CompressedRedRgtc1  <b>(0.5 Byte/Texel)</b><br />
BC5 = This is 2 channels of BC4, twice the size. CompressedRgRgtc1  <b>(1 Byte/Texel)</b></p>
<p>BC1, 2 and 3 from <a href="http://www.opengl.org/registry/specs/EXT/texture_compression_s3tc.txt">EXT_texture_compression_s3tc</a> (DirectX7+ Hardware)<br />
BC4 and 5 from <a href="http://www.opengl.org/registry/specs/ARB/texture_compression_rgtc.txt">ARB_texture_compression_rtgc</a>. (~DirectX10 Hardware)</p>
<p>The formats DXT2 and DXT4 do exist, but they include pre-multiplied Alpha which is problematic when blending with images with explicit Alpha (RGBA, DXT3/5, etc). That's why those formats have barely been used, and are partially not supported by hardware and export/import tools and they have no BCn number.</p>
<p><strong>Compressed vs. Uncompressed</strong></p>
<p>Texture compression encodes the whole Image into blocks of 4x4 <a href="http://en.wikipedia.org/wiki/Texel_(graphics)">Texel</a>, instead of storing every single Texel of the Image. Thus the ideal compressed Texture dimension is a multiple of 4, like 640x480 or a power of 2, which can be nicely fit into these Blocks. This is the ideal and not a restriction, the specification allows any non-power-of-two dimension, but will  internally use a 4x4 Block for a Texture with the size of 2x1 (the other Texels in the Block are undefined).</p>
<p>You probably guessed it already, there is a catch involved when reliably shrinking an image to 25% of it's uncompressed size: A lossy compression technique. This quality loss involved, which can be altered by tweaking the Filter options when compressing the image, is different to the one used in JPG compression. Although both formats - .dds and .jpg - are designed to compress an Image, the S3TC format was developed with graphics hardware in mind.</p>
<p>A <a href="http://en.wikipedia.org/wiki/Bilinear_filter">bilinear</a> Texture lookup usually reads 2x2 Texels from the Texture and interpolates those 4 Texels to get the final Color. Since a Block consists of 4x4 Texels, there is a good chance that all 4 Texels - which must be examined for the bilinear lookup - are in the same Block. This means that the worst case scenario involves reading 4 Blocks, but usually only 1-2 Blocks are used to achieve the bilinear lookup. When using uncompressed Textures, every bilinear lookup requires reading 4 Texels.</p>
<p>If you do the maths now you will notice that the compressed image actually needs 16 Bytes for 1 Block of RGBA Color, but the uncompressed 4 Texels of RGBA need 16 Bytes too. And yes, if you would only draw a single Pixel on the screen all this would not bring any noticable performance gains, actually it would be slower if multiple Blocks must be read to do the lookup.</p>
<p>However in OpenGL you typically draw more than a single Pixel, at least a Triangle. When the Triangle is rasterized, alot of Pixels will be very close to each other, which means their 2x2 lookup is very likely in the same 4x4 Block used by the last lookup, or a close neighbour. Graphic cards usually support this locality by using a small amount of memory in the chip for a dedicated Texture Cache. If a Cache hit is made, the cost for reading the Texels is very low, compared to reading from Video Memory.</p>
<p>That's why S3TC does decrease render times: the earlier mentioned 16 Bytes of a DXTn Block contain 16 Texels (1 Byte per Texel), while 16 Bytes of uncompressed Texture only contain 4 Texels (4 Bytes per Texel). Alot more data is stored in the 16 Bytes of DXTn, and alot of lookups will be able to use the fast Texture Cache. The game <a href="http://www.3dcenter.org/artikel/voodoo5-wickedgl/2.php">Quake 3 Arena's Framerate increases by ~20%</a> when using compressed Textures, compared to using uncompressed Textures.</p>
<p><strong>Restrictions</strong><br />
Although you might be convinced now that Texture Compression is something worth looking into, do handle it with care. After all, it's a lossy compression Technique which introduces compression Artifacts into the Texture. For Textures that are close to the Viewer this will be noticed, that's why 2D Elements which are drawn very close to the near Plane - like the Mouse Cursor, Fonts or User Interface Elements like the Health display - are usually done with uncompressed Textures, which do not suffer from Artifacts.<br />
As a rule of thumb, do not use Texture Compression where 1 Texel in the Texture will map to 1 Pixel on the Screen.</p>
<p><strong>Using OpenTK.Utilities .dds loader</strong><br />
At the time of writing, the .dds loader included with OpenTK can handle compressed 2D Textures and compressed Cube Maps. Keep in mind that the loader expects a valid OpenGL Context to be present. It will only read the file from disk and upload all MipMap levels to OpenGL. It will NOT set minification/magnification filter or wrapping mode, because it cannot guess how you intent to use it.</p>
<p>void LoadFromDisk( string filename, bool flip, out int texturehandle, out TextureTarget dimension)</p>
<p><cite>Input Parameter: filename</cite><br />
A string used to locate the DDS file on the harddisk, note that escape-sequences like "\n" are NOT stripped from the string.</p>
<p><cite>Input Parameter: flip</cite><br />
The DDS format is designed to be used with DirectX, and that defines GL.TexCoord2(0.0, 0.0) at top-left, while OpenGL uses bottom-left. If you wish to use the default OpenGL Texture Matrix, the Image must be flipped before loading it as Texture into OpenGL.</p>
<p><cite>Output Parameter: texturehandle</cite><br />
If there occured any error while loading, the loader will return "0" in this parameter. If &gt;0 it's a valid Texture that can be used with GL.BindTexture.</p>
<p><cite>Output Parameter: dimension</cite><br />
This parameter is used to identify what was loaded, currently it can return "Invalid", "Texture2D" or "TextureCube".</p>
<p><strong>Example Usage</strong></p>
<div class="geshifilter">
<pre class="geshifilter-csharp">TextureTarget ImageTextureTarget;
<span class="kw1">int</span> ImageTextureHandle;
ImageDDS.<span class="me1">LoadFromDisk</span><span class="br0">&#40;</span> <span class="st0">@"YourTexture.dds&quot;</span>, <span class="kw1">true</span>, <span class="kw1">out</span> ImageTextureHandle, <span class="kw1">out</span> ImageTextureTarget <span class="br0">&#41;</span>;
<span class="kw1">if</span> <span class="br0">&#40;</span> ImageTextureHandle == <span class="nu0">0</span> || ImageTextureTarget == TextureTarget.<span class="me1">Invalid</span> <span class="br0">&#41;</span>
   <span class="co1">// loading failed</span>
&nbsp;
<span class="co1">// load succeeded, Texture can be used.</span>
<span class="kw3">GL</span>.<span class="me1">BindTexture</span><span class="br0">&#40;</span> ImageTextureTarget, ImageTextureHandle <span class="br0">&#41;</span>;
<span class="kw3">GL</span>.<span class="me1">TexParameter</span><span class="br0">&#40;</span> ImageTextureTarget, TextureParameterName.<span class="me1">TextureMagFilter</span>, <span class="br0">&#40;</span><span class="kw1">int</span><span class="br0">&#41;</span> TextureMagFilter.<span class="me1">Linear</span> <span class="br0">&#41;</span>;
<span class="kw1">int</span><span class="br0">&#91;</span><span class="br0">&#93;</span> MipMapCount = <span class="kw1">new</span> <span class="kw1">int</span><span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span>;
<span class="kw3">GL</span>.<span class="me1">GetTexParameter</span><span class="br0">&#40;</span> ImageTextureTarget, GetTextureParameter.<span class="me1">TextureMaxLevel</span>, <span class="kw1">out</span> MipMapCount<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span> <span class="br0">&#41;</span>;
<span class="kw1">if</span> <span class="br0">&#40;</span> MipMapCount == <span class="nu0">0</span> <span class="br0">&#41;</span> <span class="co1">// if no MipMaps are present, use linear Filter</span>
  <span class="kw3">GL</span>.<span class="me1">TexParameter</span><span class="br0">&#40;</span> ImageTextureTarget, TextureParameterName.<span class="me1">TextureMinFilter</span>, <span class="br0">&#40;</span><span class="kw1">int</span><span class="br0">&#41;</span> TextureMinFilter.<span class="me1">Linear</span> <span class="br0">&#41;</span>;
<span class="kw1">else</span> <span class="co1">// MipMaps are present, use trilinear Filter</span>
  <span class="kw3">GL</span>.<span class="me1">TexParameter</span><span class="br0">&#40;</span> ImageTextureTarget, TextureParameterName.<span class="me1">TextureMinFilter</span>, <span class="br0">&#40;</span><span class="kw1">int</span><span class="br0">&#41;</span> TextureMinFilter.<span class="me1">LinearMipmapLinear</span> <span class="br0">&#41;</span>;</pre></div>
<p>Remember that you must first GL.Enable the states Texture2D or TextureCube, before using the Texture in drawing.</p>
<p><strong>Useful links:</strong></p>
<p>ATi Compressonator:<br />
<a href="http://ati.amd.com/developer/compressonator.html" title="http://ati.amd.com/developer/compressonator.html">http://ati.amd.com/developer/compressonator.html</a></p>
<p>nVidia's Photoshop Plugin:<br />
<a href="http://developer.nvidia.com/object/photoshop_dds_plugins.html" title="http://developer.nvidia.com/object/photoshop_dds_plugins.html">http://developer.nvidia.com/object/photoshop_dds_plugins.html</a></p>
<p>nVidia's GPU-accelerated Texture Tools:<br />
<a href="http://developer.nvidia.com/object/texture_tools.html" title="http://developer.nvidia.com/object/texture_tools.html">http://developer.nvidia.com/object/texture_tools.html</a></p>
<p>Detailed comparison of uncompressed vs. compressed Images:<br />
<a href="http://www.digit-life.com/articles/reviews3tcfxt1/" title="http://www.digit-life.com/articles/reviews3tcfxt1/">http://www.digit-life.com/articles/reviews3tcfxt1/</a></p>
<p>OpenGL Extension Specification:<br />
<a href="http://www.opengl.org/registry/specs/EXT/texture_compression_s3tc.txt" title="http://www.opengl.org/registry/specs/EXT/texture_compression_s3tc.txt">http://www.opengl.org/registry/specs/EXT/texture_compression_s3tc.txt</a></p>
<p>Microsoft's .dds file format specification (was used to build the OpenTK .dds loader)<br />
<a href="http://msdn.microsoft.com/archive/default.asp?url=/archive/en-us/dx81_c/directx_cpp/Graphics/ProgrammersGuide/Appendix/DDSFileFormat/ovwDDSFileFormat.asp" title="http://msdn.microsoft.com/archive/default.asp?url=/archive/en-us/dx81_c/directx_cpp/Graphics/ProgrammersGuide/Appendix/DDSFileFormat/ovwDDSFileFormat.asp">http://msdn.microsoft.com/archive/default.asp?url=/archive/en-us/dx81_c/...</a></p>
<p>DXT Compression using CUDA<br />
<a href="http://developer.download.nvidia.com/compute/cuda/sdk/website/projects/dxtc/doc/cuda_dxtc.pdf" title="http://developer.download.nvidia.com/compute/cuda/sdk/website/projects/dxtc/doc/cuda_dxtc.pdf">http://developer.download.nvidia.com/compute/cuda/sdk/website/projects/d...</a></p>
<p>Real-Time YCoCg-DXT Compression<br />
<a href="http://news.developer.nvidia.com/2007/10/real-time-ycocg.html" title="http://news.developer.nvidia.com/2007/10/real-time-ycocg.html">http://news.developer.nvidia.com/2007/10/real-time-ycocg.html</a></p>
<p>Last Update of the Links: January 2008</p>
<div class="book-navigation"><div class="page-links clear-block"><a href="http://www.opentk.com/node/15449" class="page-previous" title="Go to previous page">‹ 3d modeling company</a><a href="textures.html" class="page-up" title="Go to parent page">up</a><a href="frame-buffer-objects.html" class="page-next" title="Go to next page">Frame Buffer Objects (FBO) ›</a></div></div>
        <div class="clear-block"></div>
        
                    <div class="links">
                <ul class="links inline"><li  class="first book_printer"><a href="http://www.opentk.com/book/export/html/195" title="Show a printer-friendly version of this book page and its sub-pages." class="book_printer">Printer-friendly version</a></li>
<li  class="last comment_forbidden"><span class="comment_forbidden"><a href="http://www.opentk.com/user/login?destination=node/195%2523comment-form">Login</a> or <a href="http://www.opentk.com/user/register?destination=node/195%2523comment-form">register</a> to post comments</span></li>
</ul>            </div>
            <br />
        
		
    </div> <!-- content -->

</div> <!-- /#node-195 -->

<div id="comments">
  
</div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>

                                            <div id="main_supplements">
                        
                            <div class="block-wrapper">

	<div id="block-block-1" class="block block-block">
				<div class="content">
					<div>
		<form action="http://www.opentk.com/user?destination=node%2F195" method="post" id="user-login-form">
			<div class="form-item">
				<input type="text" value="Username" style="color: #777;" maxlength="60" name="name" id="edit-name" size="15" class="form-text required" onfocus="this.select()" />
			</div>
			<div class="form-item">
				<input type="password" value="Password" style="color: #777;" name="pass" id="edit-pass" size="15" class="form-text required" onfocus="this.select()" />
			</div>
                        <div class="form-item"><input type="submit" name="op" id="edit-submit" value="Log in" /></div>
			<div class="item-list">
				<ul>
					<li><a href="http://www.opentk.com/user/register" title="Create account">Create account</a></li>
					<li><a href="http://www.opentk.com/user/password" title="Reset password">Reset password</a></li>
				</ul>
				<input type="hidden" name="form_id" id="edit-user-login" value="user_login" />
			</div>
		</form>
	</div>
		</div>
	</div>

</div>

<div class="block-wrapper">

	<div id="block-blockcache-26" class="block block-blockcache">
					<h4 class="block-title">Commit log</h4>				<div class="content">
			<div class="item-list"><ul><li><a href="https://github.com/opentk/opentk/commit/2e51fe019771f4c70b15bb25b3a560f712a45fbf">Notice of leave</a>
</li><li><a href="https://github.com/opentk/opentk/commit/6ac1c63ff3a35367f78b500e06b2d3ca5bff3a69">Merge pull request #328 from WardBenjamin/develop</a>
</li><li><a href="https://github.com/opentk/opentk/commit/55bd3424179168eb886a853ba16633f65808320a">Fix documentation for NativeWindow.WindowBorder</a>
</li></ul></div><div class="more-link"><a href="http://www.opentk.com/aggregator/sources/1" title="View this feed&#039;s recent news.">more</a></div>		</div>
	</div>

</div>

                            
                        </div>
                                    </div>
		
            </div>
	    
	    
	</div>
	
    </div> <!-- #layer1 -->


    
        <div id="footer">

            
                            <div id="footer-layer">

<p><small>Site design by Stefanos A. Icons courtesy of <a href="http://www.gnome-look.org/content/show.php/GNOME-colors?content=82562">gnome-colors</a>.</small></p>

</div>
                    </div>

        
    
</body>


<!-- Mirrored from www.opentk.com/doc/graphics/texture-compression by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 10 May 2016 13:48:29 GMT -->
</html>
